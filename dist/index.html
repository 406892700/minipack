<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>
    minipack test
  </title>
  <script>
      var evtSource = new EventSource("/__hmr__")
      var evalChunk = (hotUpdatePath) => {
        var xhr = new XMLHttpRequest()
        xhr.open('GET', `/${hotUpdatePath}`)
        xhr.onload = () => {
          const string = xhr.responseText
          var $script = document.createElement('script')
          $script.innerHTML = string
          $script.id = +new Date()
  
          document.getElementsByTagName('head')[0].appendChild($script)
        }
  
        xhr.send(null)
        
      }
  
      // 收到服务器发生的事件时触发
      evtSource.onmessage = function (e) {
        if (e.data !== '\uD83D\uDC93') { // 不是心跳包的时候
          console.log('[hmr]: app updated!')
          const ret = JSON.stringify(e.data)
          if (ret.hot) {
            evalChunk(e.data)
          } else {
            window.location.reload()
          }
          // window.location.reload()
          
        }
        // if (e.data === 'reload') {
        //   console.log('reloading')
        //   location.reload()
        // }
      }
  
      // 成功与服务器发生连接时触发
      evtSource.onopen = function () {
        console.log("Server open")
      }
  
      // 出现错误时触发
      evtSource.onerror = function () {
        console.log("Error")
      }
    </script>
</head>

<body>
  <h2>热更新/自动刷新</h2>
<script src="./dist.ce506.js"></script>
</body>

</html>